library(tidyverse)
library(camcorder)
 
gg_record(dir = "mappromptmonday-temp", device = "png", width = 7, height = 9, units = "in", dpi = 320)

# https://climate-adapt.eea.europa.eu/en/metadata/indicators/extreme-sea-level
waterlevel_raw <- ncdf4::nc_open(here::here("2023/2023-week_22/data/future_waterlevel_actual-value_2021-2050_rp10_ensemble-median_best-fit_v1.nc"))

waterlevels <- ncdf4::ncvar_get(waterlevel_raw, "ensemble_median_waterlevel")
station_x_coordinate <- ncdf4::ncvar_get(waterlevel_raw, "station_x_coordinate")
station_y_coordinate <- ncdf4::ncvar_get(waterlevel_raw, "station_y_coordinate")

wl_df <- as_tibble(waterlevels)
x_df <- as_tibble(station_x_coordinate)
y_df <- as_tibble(station_y_coordinate)

wl <- bind_cols(x_df, y_df, wl_df) %>% 
  select(x = 1, y = 2, wlv = 3)

wl_sf <- wl %>% 
  sf::st_as_sf(coords = c("x", "y"), crs = 4326)

f1 <- "Outfit"

ggplot(wl_sf) +
  geom_sf(aes(color = wlv), size = 0.1, shape = 4) +
  MetBrewer::scale_color_met_c("Johnson", direction = -1) +
  coord_sf(crs = "+proj=aea +lat_1=30 +lat_2=60 +lat_0=0 +lon_0=25 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs", default_crs = sf::st_crs(4326), xlim = c(-22, 45), ylim = c(28, 74)) +
  guides(color = guide_colorbar(title.position = "top")) +
  labs(
    title = "Sea Level Change",
    subtitle = "Median of total water levels, 2021-2050",
    caption = "Source: Copernicus Climate Change Service Â· Graphic: Georgios Karamanis",
    color = "Meters"
  ) +
  theme_void(base_family = f1) +
  theme(
    legend.position = c(0.24, 0.08),
    legend.direction = "horizontal",
    legend.text = element_text(color = "grey95"),
    legend.title = element_text(color = "grey95"),
    legend.key.width = unit(2.5, "lines"),
    legend.key.height = unit(0.6, "lines"),
    plot.background = element_rect(fill = "grey5", color = NA),
    plot.title = element_text(color = "grey95", face = "bold"),
    plot.subtitle = element_text(color = "grey95", margin = margin(5, 0, 20, 0)),
    plot.caption = element_text(color = "grey95", margin = margin(10, 0, 0, 0)),
    plot.margin = margin(10, 10, 10, 10)
  )
  
